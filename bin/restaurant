#!/bin/sh

set -e

realpath () {
    local r=$1; local t=$(readlink $r)
    while [ $t ]; do
        r=$(cd $(dirname $r) && cd $(dirname $t) && pwd -P)/$(basename $t)
        t=$(readlink $r)
    done
    echo $r
}

ME=$(realpath $0)
MYDIR=$(dirname $ME)

if [ ! -z $EMACS ]; then
    :
elif [ -x $MYDIR/../emacs/src/emacs ]; then
    export EMACS=$MYDIR/../emacs/src/emacs
    export EMACSDATA=$MYDIR/../emacs/etc/
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$MYDIR/../emacs/lib/
elif [ ! -z `which emacs` ]; then
    export EMACS=`which emacs`
else
    echo "ERROR: There is no ``emacs`` binary in system"
    exit 1
fi

$EMACS -q -l $MYDIR/../init.el --name restaurant --title "Restaurant - Emacs-based Chef IDE" $@
