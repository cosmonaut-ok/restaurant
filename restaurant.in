#!/bin/sh

set -e

ME=$(readlink -f $0)
MYDIR=$(dirname $ME)

if [ ! -z $EMACS ]; then
    :
elif [ -x $MYDIR/@LOCAL_EMACS_DIR@/bin/emacs ]; then
    export EMACS=$MYDIR/@LOCAL_EMACS_DIR@/bin/emacs
    export EMACSDATA=$MYDIR/@LOCAL_EMACS_DIR@/etc/
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$MYDIR/@LOCAL_EMACS_DIR@/lib/
elif [ ! -z `which emacs` ]; then
    export EMACS=`which emacs`
else
    echo "ERROR: There is no ``emacs`` binary in system"
    exit 1
fi

if [ ! -z "$1" ] && [ "$1" = '-d' ]; then
    OPTIONS="$OPTIONS --debug-init --eval '(toggle-debug-on-error)'"
    shift
fi

VERSION=$(grep autoconf-anchor $MYDIR/src/restaurant-help.el | cut -d\" -f2 | tr -d \\n)

$EMACS -q -l $MYDIR/src/restaurant.el --name restaurant --title "Restaurant Chef IDE version: (v.${VERSION})" $OPTIONS $@
